import base64
import io

import customtkinter
from PIL import ImageTk, Image
import tkinter as tk

from Managers.AccountsManager import AccountManager
from Managers.LogManager import LogManager
from .sidebar import Sidebar
from .main_menu import MainMenu
from .config_tab import ConfigTab
from .accounts_list_frame import AccountsListFrame
from .accounts_tab import AccountsControl
from .control_frame import ControlFrame

customtkinter.set_appearance_mode("System")
customtkinter.set_default_color_theme("blue")
icon_base64 = b"""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"""


class App(customtkinter.CTk):
    def __init__(self):
        super().__init__()
        self.title("FSN not Autofarm panel | v.0.0.1")
        self.geometry("1100x580")

        self.icon_photo = tk.PhotoImage(data=icon_base64)
        self.iconphoto(True, self.icon_photo)

        self.grid_columnconfigure(1, weight=1)
        self.grid_rowconfigure((0, 1), weight=1)

        self.sidebar = Sidebar(self)
        self.textbox = customtkinter.CTkTextbox(self, width=50)
        self.textbox.grid(row=0, column=1, padx=(20,0), pady=(20,0), sticky="nsew")

        self.log_manager = LogManager(self.textbox)
        account_manager = AccountManager()
        accounts = account_manager.get_all_accounts()

        print("Найденные аккаунты:")
        for acc in accounts:
            print(f"Логин: {acc.login}, Пароль: {acc.password}, Shared Secret: {acc.shared_secret}")
        self.main_menu = MainMenu(self)
        self.config_tab = ConfigTab(self)
        self.accounts_list = AccountsListFrame(self)
        self.accounts_list.grid(row=1, column=1, padx=(20, 0), pady=(20, 0), sticky="nsew")
        self.accounts_control = AccountsControl(self, self.accounts_list.update_label)
        self.control_frame = ControlFrame(self)

        self.sidebar.set_defaults()
